---
layout: single
title: Burpsuite en el Pentesting android
date: 2022-05-22
classes: wide
header:
  teaser: /assets/images/masthead.png
categories:
  - Mobile
  - Pentesting
  - Android
tags:
  - H4ch1rou
  - 
  -
---


Interceptar las comunicaciones HTTP/HTTPS con BurpSuite 
---

Burpsuite es una herramienta que permite interceptar y modificar las peticiones realizadas entre un cliente y un servidor que esten bajo el protocolo HTTP, puede ser una pagina web a traves del browser (mozilla, chrome, etc), pero para el caso de la tecnologia mobile no es la excepcion. 



Interceptar Peticiones HTTP 
---

En el caso de que queramos inteceptar comunicacion HTTP solamente debemos dejar nuestro emulador configurado con los datos de nuestro proxy


Deslicamos hacia abajo el menu 

![image-center](/assets/images/mobile/gennymotion-vmSGS7_proxy_1.png){: .align-center }

Mantenemos precionado el wifi 

![image-center](/assets/images/mobile/gennymotion-vmSGS7_proxy_2.png){: .align-center }

Cambiamos el proxy por la IP 10.0.3.2 que hace referencia a nuestro localhost donde tenemos montado nuestro proxy

![image-center](/assets/images/mobile/gennymotion-vmSGS7_proxy_3.png){: .align-center }

Si nos vamos a la configuracion de burpsuite deberia estar en la escucha 127.0.0.1:8080 esto lo debemos modificar por All interfaces 
para que podemos recibir peticiones de cualquier lado 

![image-center](/assets/images/mobile/gennymotion-vmSGS7_proxy_4.png){: .align-center }

ya con eso podemos interceptar las peticiones HTTP que realice el emulador, por ejemplo con el navegador 

![image-center](/assets/images/mobile/gennymotion-vmSGS7_proxy_5.png){: .align-center }


Interceptar Peticiones HTTPS
---

Para lograr interceptar las peticiones cifradas (HTTPS) debemos instalar el certificado digital que tiene BURPSUITE en el celular, esto nos permitira abrir las comunicaciones y poder realizar el ataque de MITM sin problemas. 

Primero que nada debemos entrar a la url local http://127.0.0.1:8080 para descargar el certificado de burp

![image-center](/assets/images/mobile/gennymotion-vmSGS7_cert_1.png){: .align-center }

Muy importante para poder instalarlo debemos cambiarle el nombre de la extension de .der a .cer con esto nuestro emulador lograra reconocerlo como un certificado. 


* Lo arrastramos hacia nuestro emulador y lo copiamos dentro, esto quedara en la carpeta download como cacert.cer
* Luego nos vamos a setting
* Security & Location
* Encryptions & credentials
* Install From SD Card

![image-center](/assets/images/mobile/gennymotion-vmSGS7_cert_2.png){: .align-center }

y con eso tendremos instalado nuestro ceriticado, para comprobarlo nos vemos a User Credentials y podremos ver nuestro certificado

![image-center](/assets/images/mobile/gennymotion-vmSGS7_cert_3.png){: .align-center }

Instalacion de certificado en versiones superiores a 7.0 de Android
---

Las versiones superiores a la 7.0 en varios casos podemos ver que no detecta la instalacion del certificado digital del usuario, si no que tenemos que instarlo a nivel de sistema, esto tambien ocurre si es que esta expresamente escrito en el fichero AndroidManifest.xml de la apk que estemos analizando. 

Para revisar los certificados instalados a nivel de sistema debemos ver la ruta /system/etc/security/

```bash 
adb shell 
ls -la /system/etc/security/cacerts

# entregando un resultado parecido a este
rwxr-xr-x 2 root root 4096 2021-02-03 03:28 .
drwxr-xr-x 3 root root 4096 2021-02-03 03:30 ..
-rw-r--r-- 1 root root 4767 2021-02-03 03:28 00673b5b.0
-rw-r--r-- 1 root root 7195 2021-02-03 03:28 02756ea4.0
-rw-r--r-- 1 root root 4919 2021-02-03 03:28 02b73561.0
-rw-r--r-- 1 root root 7142 2021-02-03 03:28 03f2b8cf.0
-rw-r--r-- 1 root root 2877 2021-02-03 03:28 04f60c28.0
-rw-r--r-- 1 root root 4836 2021-02-03 03:28 052e396b.0
-rw-r--r-- 1 root root 5322 2021-02-03 03:28 08aef7bb.0
-rw-r--r-- 1 root root 4922 2021-02-03 03:28 0d5a4e1c.0
-rw-r--r-- 1 root root 2308 2021-02-03 03:28 0d69c7e1.0
-rw-r--r-- 1 root root 4614 2021-02-03 03:28 10531352.0
-rw-r--r-- 1 root root 4716 2021-02-03 03:28 111e6273.0
-rw-r--r-- 1 root root 4927 2021-02-03 03:28 124bbd54.0
-rw-r--r-- 1 root root 4300 2021-02-03 03:28 12d55845.0
-rw-r--r-- 1 root root 4765 2021-02-03 03:28 1676090a.0
-rw-r--r-- 1 root root 4578 2021-02-03 03:28 17b51fe6.0
-rw-r--r-- 1 root root 4890 2021-02-03 03:28 1dac3003.0
-rw-r--r-- 1 root root 7088 2021-02-03 03:28 1dcd6f4c.0
-rw-r--r-- 1 root root 4923 2021-02-03 03:28 1df5a75f.0
-rw-r--r-- 1 root root 4527 2021-02-03 03:28 1e1eab7c.0
...
```
Si nos damos cuenta estan en formato PEM y el nombre es igual a subject_hash_old.

Por lo tanto una vez que generamos nuestro certificado debemos convertirlo al formato PEM 

```bash
#convertimos el certificado
openssl x509 -inform DER -in cacert.cer -out cacert.pem

# obtenemos el subject_hash_old
openssl x509 -inform PEM -subject_hash_old -in cacert.pem | head -1

# renombramos el archivo
mv cacert.pem [SUBJECT-HASH-OLD].0

# Pasamos a root 
adb root 

# remount partitions read-write
adb remount 

# subimos el certificado al dispositivo
adb push [SUBJECT-HASH-OLD].0 /sdcard/

# Ingresamos al dispositivo
adb shell

# Cargamos el certificado al directorio de certificados 
mv /sdcard/[SUBJECT-HASH-OLD].0 /system/etc/security/cacerts/

# Le otorgamos los permisos correspondientes 
chmod 644 /system/etc/security/cacerts/[SUBJECT-HASH-OLD].0  

# Reiniciamos el dispositivo
reboot
```

![image-center](/assets/images/mobile/gennymotion-vmSGS7_cert_5.png){: .align-center }

